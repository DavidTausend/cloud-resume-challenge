---
- name: Purge Azure Front Door endpoint cache
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    resource_group: cloud-resume-challenge
    profile_name: "fd-pkobsusvshrnm"   
    endpoint_name: "ep-pkobsusvshrnm"  
    paths:
      - "/*"         

  tasks:
    - name: Purge AFD endpoint cache
      ansible.builtin.command: >
        az afd endpoint purge
        --resource-group {{ resource_group }}
        --profile-name {{ profile_name }}
        --endpoint-name {{ endpoint_name }}
        --content-paths {{ paths | to_json }}
      register: purge_out
      changed_when: purge_out.rc == 0

    - name: Summary
      ansible.builtin.debug:
        msg:
          - "Profile: {{ profile_name }}"
          - "Endpoint: {{ endpoint_name }}"
          - "Paths: {{ paths }}"